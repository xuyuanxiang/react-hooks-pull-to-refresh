import { Meta, Props } from '@storybook/addon-docs/blocks';

<Meta title="Basic|单独使用" />

# 使用示例

```typescript jsx
import React, { useState } from 'react';
import { usePullToRefresh } from 'react-hooks-pull-to-refresh';

function MyComponent() {
  const [dataSource, setDataSource] = useState<string[]>([]);

  const onRefresh = async (): Promise<void> => {
    const res = await fetch('/api/to/something');
    if (res.ok) {
      const { data } = await res.json();
      setDataSource(data);
    }
  };

  const options = {}; // 查看下方表格
  const refresherRef = usePullToRefresh(onRefresh, options);

  return (
    <div ref={refresherRef} style={{ background: '#ffffff' }}>
      {dataSource.map((it, idx) => (
        <p key={`item_${idx}`}>{it}</p>
      ))}
    </div>
  );
}
```

`usePullToRefresh`第二个参数:

| 变量名 | 描述 | 缺省值 |
| :-- | :-- | :-- |
| threshold | 当用户下拉距离大于等于 threshold 时，释放后会调用`onRefresh` | 45 |
| throttle | 处理`touchmove`事件的时间间隔，单位：毫秒。 数值越小，追踪手指在 Y 轴方向位移就越精准，但可能会带来性能问题。 | 150 |
| refreshControl | `RefreshControl`组件，用于控制`pull-to-refresh`交互行为中的视图呈现。 | RefreshControl |

## 自定义 hint、edge、indicator

三者关系：

- 滚动视图已经到达顶部后，继续下拉显示 hint。
- 已经显示 hint 后，继续下拉距离达到 threshold 属性所传距离后显示 edge。
- 已经显示 edge 后，用户释放手指（touchend)，会调用 onRefresh，在 Promise 返回结果前一直显示 indicator。

```typescript
import React, { useState } from 'react';
import { usePullToRefresh, RefreshControl } from 'react-hooks-pull-to-refresh';

function MyComponent() {
  const [dataSource, setDataSource] = useState<string[]>([]);

  const onRefresh = async (): Promise<void> => {
    const res = await fetch('/api/to/something');
    if (res.ok) {
      const { data } = await res.json();
      setDataSource(data);
    }
  };

  const options = {
    refreshControl: <RefreshControl hint="👇下拉可以刷新" edge="👆释放后开始刷新" indicator="正在加载..." />,
  };
  const refresherRef = usePullToRefresh(onRefresh, options);

  return (
    <div ref={refresherRef} style={{ background: '#ffffff' }}>
      {dataSource.map((it, idx) => (
        <p key={`item_${idx}`}>{it}</p>
      ))}
    </div>
  );
}
```

## 自定义 RefreshControl 容器

RefreshControl 默认是一个`div`元素，样式：

```css
background-color: #f6f6f6;
text-align: center;
padding: 32px;
```

自定义：

```typescript
import React from 'react';
import { RefreshControlConsumer } from 'react-hooks-pull-to-refresh';

function MyRefreshControl() {
  return (
    <RefreshControlConsumer>
      {({ state }) => {
        if (state === RefreshState.REFRESHING) {
          return (
            <div>
              Loading...
            </div>
          );
        }
        // else if ...
      }}
    </RefreshControlConsumer>
  );
}
```
